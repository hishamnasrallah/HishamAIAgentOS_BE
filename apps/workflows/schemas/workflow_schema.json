{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "HishamOS Workflow Definition Schema",
    "description": "JSON Schema for defining multi-step AI-driven workflows in HishamOS",
    "type": "object",
    "required": [
        "name",
        "version",
        "steps"
    ],
    "properties": {
        "name": {
            "type": "string",
            "description": "Human-readable workflow name",
            "minLength": 1,
            "maxLength": 200,
            "examples": [
                "Bug Lifecycle",
                "Feature Development",
                "Code Review"
            ]
        },
        "version": {
            "type": "string",
            "pattern": "^\\d+\\.\\d+(\\.\\d+)?$",
            "description": "Semantic version (e.g., 1.0, 2.1.3)",
            "examples": [
                "1.0",
                "2.0.1"
            ]
        },
        "description": {
            "type": "string",
            "description": "Detailed workflow description",
            "maxLength": 1000
        },
        "metadata": {
            "type": "object",
            "description": "Additional workflow metadata",
            "properties": {
                "author": {
                    "type": "string"
                },
                "created_date": {
                    "type": "string",
                    "format": "date"
                },
                "tags": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                }
            }
        },
        "steps": {
            "type": "array",
            "description": "Array of workflow steps",
            "minItems": 1,
            "items": {
                "$ref": "#/definitions/step"
            }
        }
    },
    "definitions": {
        "step": {
            "type": "object",
            "required": [
                "id",
                "agent"
            ],
            "properties": {
                "id": {
                    "type": "string",
                    "pattern": "^[a-z][a-z0-9_]*$",
                    "description": "Unique step identifier (lowercase, underscores)",
                    "examples": [
                        "triage",
                        "assign_developer",
                        "code_review"
                    ]
                },
                "name": {
                    "type": "string",
                    "description": "Human-readable step name",
                    "examples": [
                        "Bug Triage",
                        "Assign to Developer"
                    ]
                },
                "agent": {
                    "type": "string",
                    "description": "Agent name or ID to execute this step",
                    "examples": [
                        "bug-triage-agent",
                        "coding-agent",
                        "qa-agent"
                    ]
                },
                "inputs": {
                    "type": "object",
                    "description": "Input parameters for the step (supports {{variable}} syntax)",
                    "additionalProperties": true,
                    "examples": [
                        {
                            "bug_description": "{{input.bug_description}}",
                            "project_context": "{{input.project}}"
                        }
                    ]
                },
                "condition": {
                    "type": "string",
                    "description": "Optional condition to execute this step (supports {{variable}} and boolean operators)",
                    "examples": [
                        "{{steps.triage.output.severity}} > 3",
                        "{{input.requires_review}} == true"
                    ]
                },
                "on_success": {
                    "type": "string",
                    "description": "Next step ID on successful execution",
                    "examples": [
                        "assign",
                        "code_review"
                    ]
                },
                "on_failure": {
                    "type": "string",
                    "description": "Next step ID on failure (optional, defaults to workflow failure)",
                    "examples": [
                        "notify_team",
                        "escalate"
                    ]
                },
                "max_retries": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 10,
                    "default": 3,
                    "description": "Maximum retry attempts on failure"
                },
                "timeout_seconds": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 3600,
                    "default": 300,
                    "description": "Step execution timeout in seconds"
                },
                "skip_if": {
                    "type": "string",
                    "description": "Condition to skip this step",
                    "examples": [
                        "{{steps.triage.output.severity}} == 1"
                    ]
                }
            }
        }
    },
    "additionalProperties": false
}